## Anara 365 — ежедневная рассылка в Telegram

Бот отправляет одно сообщение в день (Asia/Qostanay, UTC+6) в чат Анара. 29 декабря 2025 — старт марафона и особый день с четырьмя разными поздравлениями.

### Что делает скрипт
- `src/send_daily.py` вычисляет номер дня марафона (старт 2025-12-29), собирает детерминированный текст из пулов и шлёт `sendMessage`. Для 29 декабря есть 4 разных сообщения по слотам: утро, день, вечер, ночь.
- `happy_birthday_anara/content.py` содержит пулы (40+ комплиментов, 60+ идей, 15+ подписей, 10 шаблонов) и логику выбора слота на особый день.
- `src/get_chat_id.py` вытаскивает `CHAT_ID` через `getUpdates` или просто печатает вручную переданный ID.

### Быстрый старт локально
1) Создай бота через BotFather и получи `BOT_TOKEN`.
2) Копируй `.env.example` в `.env` и заполни `BOT_TOKEN`, `CHAT_ID` (временный можно оставить пустым до шага 5).
3) Установи зависимости: `python -m venv .venv && source .venv/bin/activate` и `pip install -r requirements.txt`.
4) Активация таймзоны не нужна — скрипт сам использует `Asia/Qostanay`.
5) Чтобы получить `CHAT_ID`: напиши боту `/start`, затем `python src/get_chat_id.py`. В ответе появится `CHAT_ID=...`. Либо передай вручную: `python src/get_chat_id.py --manual 123456789`.
6) Тестовая отправка: `python src/send_daily.py` (использует текущую дату; до 2025-12-29 ничего не отправит, после 365-го дня тоже пропустит).

### GitHub Actions
- Файл: `.github/workflows/daily.yml`.
- Секреты: в репозитории создай `BOT_TOKEN`, `CHAT_ID`.
- Расписание (UTC): ежедневный запуск `04:00` (это 10:00 Asia/Qostanay) и дополнительные только 29 декабря `07:00`, `12:00`, `15:00` (13:00, 18:00, 21:00 местное время).
- Шаги: checkout → setup-python 3.11 → `pip install -r requirements.txt` → `python src/send_daily.py`.
- Скрипт логирует только `sent ok` или понятные ошибки, токен не выводится.

### Поведение контента
- Дни 2–365: одно сообщение в день, текст детерминирован по номеру дня (сид = номер дня), поэтому при повторном запуске в тот же день текст совпадает.
- 29 декабря 2025: 4 разных текста по слотам (утро 5–11, день 12–16, вечер 17–21, ночь остальное). Cron уже настроен на 10:00, 13:00, 18:00, 21:00 местное время.
- Если дата раньше старта или позже 365-го дня — выход без отправки.

### Безопасность и отладка
- При отсутствии переменных окружения скрипт завершается с кодом 1 и подсказкой.
- Все HTTP ошибки и ответы Telegram (`ok=false`) выводятся в stderr и завершают выполнение.
